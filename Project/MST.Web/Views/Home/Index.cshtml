<!DOCTYPE html>
<html style="overflow: hidden;">
<head>
    <title>崇令WMS平台</title>
    <link href="~/Content/css/framework-font.css" rel="stylesheet" />
    <script src="~/Content/js/jquery/jquery-2.1.1.min.js"></script>
    <script src="~/Content/js/bootstrap/bootstrap.js"></script>
    <link href="~/Content/js/bootstrap/bootstrap.min.css" rel="stylesheet" />
    <script src="~/Content/js/dialog/dialog.js"></script>
    <script src="~/Content/js/cookie/jquery.cookie.js"></script>
    <link href="~/Content/css/framework-theme.css" rel="stylesheet" />
    <script src="~/Content/js/framework-ui.js"></script>
    <script src="~/Content/js/framework-clientdata.js"></script>
    <script src="~/Scripts/jquery.signalR-2.4.3.js"></script>
    <script src="~/signalr/hubs" type="text/javascript"></script>
    <script src="~/Content/js/websocket.js"></script>
    <script>
        $(function () {
            console.log("货位分配测试：LocInPar(num, areaPrefix, isEmpty, containertype); 或 LocInTask(num, taskInNo);LocInPar(2,'N',false,'NormalBoxA')--StandardPlastic,InnerRack");
            GetInfoCount();

            $("#msgBtn").click(function () {
                $("span").each(function (i, n) {
                    if ($(n).text() == "消息管理") {
                        if (!$(n).parent().parent().hasClass("open")) {
                            $(n).trigger("click");
                        }
                        var menu = $(n).parents("li").find("a[class='menuItem'][href='/PC_MsgManage/Msg/Index']");
                        $(menu).trigger("click");
                    }
                });
            });

            $(function () {
                $(window).resize(function () {
                    $("#sidebar-nav>ul>li").each(function (i, n) {
                        if ($(n).hasClass("open")) {
                            var count = $(n).find("li").length;
                            var height = 10 + (38 * count);
                            $(n).find("ul").css("height", height + "px");
                        }
                    });
                });
            });


            var chat = InitSignalR();

            $("#logo").click(function () {
                chat.server.sendAll("Test", { IsSuccess:true,Data:"成功"});
            });

            window.top.SignalRFun.Test = function (msg) {
                console.log("SignalR消息:" + msg.Data);
            };

            window.top.SignalRFun.NoReadNum = function (msg) {
                if (msg.Data == 0) {
                    $("#msgCount").hide();
                }
                else {
                    if (msg.Data > 99) {
                        $("#msgCount").text("..").show();
                        $("#msgCount").css("line-height", "9px");
                    }
                    else {
                        $("#msgCount").text(msg.Data).show();
                    }
                }
            };

            window.top.SignalRFun.EnableLogin = function (msg) {
                top.layer.confirm(msg.Data, {
                    icon: "fa-exclamation-circle",
                    title: "系统提示",
                    btn: ['确认'],
                    btnclass: ['btn btn-primary', 'btn btn-danger'],
                    cancel: function () {
                        location.href = "../Login/OutLogin";
                    }
                }, function () {
                    location.href = "../Login/OutLogin";
                });
            };

        });




        //获取消息数量
        function GetInfoCount() {
            $.ajaxWMS({
                url: "/Home/GetMsgCount",
                data: {},
                dataType: "json",
                type: "GET",
                async: false,
                success: function (data) {
                    if (data.MsgCount == "0") {
                        $("#msgCount").hide();
                    }
                    else {
                        $("#msgCount").css("line-height", "14px");
                        if (data.MsgCount > 99) {
                            $("#msgCount").text("..").show();
                            $("#msgCount").css("line-height", "9px");
                        }
                        else {
                            $("#msgCount").text(data.MsgCount).show();
                        }
                    }
                }
            });
        }

        //通过参数测试货位分配
        //num 个数,
        //areaPrefix: N：一般存储区，B：大件存储区，Z：空料箱暂存区
        //isEmpty:是否空料箱(空料箱分配货位需结婚是否ERP物理区域，若非ERP物理区域未启用，则优先分配到右侧货位)
        //containertype:  NormalBoxA:  470*330*200  (深*宽*高)
        //                NormalBoxB:  460*330*230
        //                NormalBoxC:  520*370*250
        //                NormalBoxD:  455*385*250
        //                NormalBoxE:  570*380*340
        //                StandardPlastic:  600*400*350
        //                InnerRack:  1560*900*1800
        function LocInPar(num, areaPrefix, isEmpty, containertype) {
            if (num == null && areaPrefix == null && isEmpty == null && containertype == null) { //此处仅用于快速找到方法定义
                debugger;
                return;
            }

            $.ajaxWMS({
                url: "/Home/LocInPar?num=" + num + "&areaPrefix=" + areaPrefix + "&isEmpty=" + isEmpty + "&containertype=" + containertype,
                data: {},
                dataType: "json",
                type: "GET",
                async: false,
                success: function (data) {
                    if (data.success == true) {
                        $.each(data.List, function (i, n) {
                            var resLoc = "";
                            if (n.Loc.Width < n.conType.BorderWidth || n.Loc.High < n.conType.BorderHeight) {
                                resLoc = "[×]"
                            }
                            else {
                                resLoc = "[√]"
                            }

                            var resMin = "";
                            if (n.Loc.Width < n.conType.LocMinWidth || n.Loc.High < n.conType.LocMinHeight) {
                                resMin = "[×]"
                            }
                            else {
                                resMin = "[√]"
                            }

                            var resMax = "";
                            if ((n.conType.LocMaxWidth != null && n.conType.LocMaxWidth != 0 && n.Loc.Width > n.conType.LocMaxWidth) || (n.conType.LocMaxHeight != null && n.conType.LocMaxHeight != 0 && n.Loc.High > n.conType.LocMaxHeight)) {
                                resMax = "[×]"
                            }
                            else {
                                resMax = "[√]"
                            }

                            console.log(n.Loc.LocationCode + "： 巷道：" + PadLeft(n.Loc.WayCode, 3, " ")
                                + ",  行：" + PadLeft(n.Loc.Line, 3, " ")
                                + ",  货位宽：" + PadLeft(n.Loc.Width, 4, " ")
                                + ",  货位高：" + PadLeft(n.Loc.High, 4, " ")
                                + ",  容器宽：" + PadLeft(n.conType.BorderWidth, 4, " ")
                                + ",  容器高：" + PadLeft(n.conType.BorderHeight, 4, " ")
                                + ",  限定最小宽：" + PadLeft(n.conType.LocMinWidth, 4, " ")
                                + ",  限定最小高：" + PadLeft(n.conType.LocMinHeight, 4, " ")
                                + ",  限定最大宽：" + PadLeft(n.conType.LocMaxWidth, 4, " ")
                                + ",  限定最大高：" + PadLeft(n.conType.LocMaxHeight, 4, " ")
                                + ("   货位与容器尺寸：" + resLoc + "   货位与最小尺寸:" + resMin + "   货位与最大尺寸:" + resMax)
                                + "\r\n\r\n"
                                + "日志:" + n.log
                            );
                        });
                    }
                    else {
                        console.log(data.msg);
                    }
                }
            });
        }

        //通过任务测试货位分配
        function LocInTask(num, taskInNo) {
            if (num == null && taskInNo == null) { //此处仅用于快速找到方法定义
                debugger;
                return;
            }

            $.ajaxWMS({
                url: "/Home/LocInTask?num=" + num + "&taskInNo=" + taskInNo,
                data: {},
                dataType: "json",
                type: "GET",
                async: false,
                success: function (data) {
                    if (data.success == true) {
                        $.each(data.List, function (i, n) {
                            console.log(n.Loc.LocationCode + "：    巷道：" + PadLeft(n.Loc.WayCode, 3, " ") + ",    货位宽：" + PadLeft(n.Loc.Width, 5, " ") + ",     货位高：" + PadLeft(n.Loc.High, 5, " ") + ",    容器宽：" + PadLeft(n.conType.BorderWidth, 5, " ") + ",    容器高：" + PadLeft(n.conType.BorderHeight, 5, " "));
                        });
                    }
                    else {
                        console.log(data.msg);
                    }
                }
            });
        }

        //许可证
        function btn_Lic() {
            $.modalOpen({
                id: "Lic",
                title: "许可证",
                url: "/SystemManage/User/Lic",
                width: "700px",
                height: "570px",
                callBack: function (iframeId) {
                    top.frames[iframeId].submitForm();
                }
            });
        }

        //下载RF设备APP
        function downloadFile(url) {
            $(this).unbind("click");
            $("body").append($("<iframe/>").css("display", "none").attr("src", url));
        }

        function PadLeft(oldStr, len, charStr) {
            var oldLength = (oldStr + "").length;
            var newStr = oldStr;
            for (var i = 0; i < len - oldLength; i++) {
                newStr = charStr + newStr;
            }
            return newStr;
        }


    </script>
</head>
<body style="overflow: hidden;">
    <div id="ajax-loader" style="cursor: progress; position: fixed; top: -50%; left: -50%; width: 200%; height: 200%; background: #fff; z-index: 10000; overflow: hidden;">
        <img src="~/Content/img/ajax-loader.gif" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; margin: auto;" />
    </div>
    <div id="theme-wrapper">
        <header class="navbar" id="header-navbar">
            <div class="container" style="padding-right: 0px;">
                @*<a href="#" id="logo" class="navbar-brand">崇令WMS平台</a>*@
                @*<div style="width:212px;float:left;padding-left:20px;">
            <img src="/Content/img/Logo_Small.png" style="width: 16%; height: 16%; margin-top: -3px">
            <span style="line-height: 50px; font-size: 17px; color: #fff; padding-left: 10px; margin-top: 10px;">崇令WMS系统</span>
        </div>*@
                <div style="width:212px;float:left;padding-left:20px;height:50px;display:flex;">
                    <img id="logo" src="@ViewBag.LogoPath" style="margin-top: auto; margin-bottom: auto; max-width: @(ViewBag.LogoScale); max-height: @(ViewBag.LogoScale); object-fit: contain; flex: 1; ">
                    <b style="line-height: 50px; font-size: 17px; color: #fff; padding-left: 10px;flex:5; ">@(ViewBag.SoftName+ViewBag.SoftPubName)</b>
                </div>
                <div class="clearfix">
                    <div class="nav-no-collapse navbar-left pull-left hidden-sm hidden-xs">
                        <ul class="nav navbar-nav pull-left">
                            <li>
                                <a class="btn" id="make-small-nav"><i class="fa fa-bars"></i></a>
                            </li>
                        </ul>
                    </div>
                    <div class="nav-no-collapse pull-right" id="header-nav">
                        <ul class="nav navbar-nav pull-right">
                            <li id="msgBtn" class="dropdown hidden-xs">
                                <a class="btn dropdown-toggle" data-toggle="dropdown">
                                    <i class="fa fa-bell"></i>
                                    <span id="msgCount" style="display:none" class="count">0</span>
                                </a>
                            </li>
                            <li class="dropdown profile-dropdown">
                                <a href="#" class="dropdown" data-toggle="dropdown">
                                    <img src="~/Content/img/samples/scarlet-159.png" alt="" />
                                    <span class="hidden-xs">@(MST.Code.OperatorProvider.Provider.GetCurrent()==null?"":MST.Code.OperatorProvider.Provider.GetCurrent().UserName)</span>
                                </a>
                                <ul class="dropdown-menu pull-right">
                                    <li><a class="menuItem" data-id="userInfo" href="/SystemManage/User/Info"><i class="fa fa-user"></i>个人信息</a></li>
                                    <li><a href="javascript:void(0);" onclick='downloadFile("../app/PDA.apk")'><i class="fa fa-android"></i>手持下载</a></li>
                                    <li class="divider"></li>
                                    <li><a href="~/Login/OutLogin"><i class="ace-icon fa fa-power-off"></i>安全退出</a></li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </header>
        <div id="page-wrapper" class="container">
            <div class="row">
                <div id="nav-col">
                    <section id="col-left" class="col-left-nano">
                        <div id="col-left-inner" class="col-left-nano-content">
                            <div id="user-left-box" class="clearfix hidden-sm hidden-xs dropdown profile2-dropdown">

                            </div>
                            <div class="collapse navbar-collapse navbar-ex1-collapse" id="sidebar-nav" >
                                <ul class="nav nav-pills nav-stacked">
                                    <li class="nav-header hidden-sm hidden-xs">
                                        常用菜单
                                        <i class="fa fa-gear" style="color: #868b98; font-size: 12px; margin-top: -6px; position: absolute; right: 23px; top: 50%; cursor: pointer;"></i>
                                    </li>
                                    <li class="common">
                                        <a href="~/PC_BoardManage/Board/BoardView" target="_blank">
                                            <i class="fa fa-star-o"></i>
                                            <span>电子看板</span>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </section>
                </div>
                <div id="content-wrapper">
                    <div class="content-tabs">
                        <button class="roll-nav roll-left tabLeft">
                            <i class="fa fa-backward"></i>
                        </button>
                        <nav class="page-tabs menuTabs">
                            <div class="page-tabs-content" style="margin-left: 0px;">
                                <a href="javascript:;" class="menuTab active" data-id="/Home/Default">欢迎首页</a>
                            </div>
                        </nav>
                        <button class="roll-nav roll-right tabRight">
                            <i class="fa fa-forward" style="margin-left: 3px;"></i>
                        </button>
                        <div class="btn-group roll-nav roll-right">
                            <button class="dropdown tabClose" data-toggle="dropdown">
                                页签操作<i class="fa fa-caret-down" style="padding-left: 3px;"></i>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-right">
                                <li><a class="tabReload" href="#">刷新当前</a></li>
                                <li><a class="tabCloseCurrent" href="#">关闭当前</a></li>
                                <li><a class="tabCloseAll" href="#">全部关闭</a></li>
                                <li><a class="tabCloseOther" href="#">除此之外全部关闭</a></li>
                            </ul>
                        </div>
                        <button class="roll-nav roll-right fullscreen"><i class="fa fa-arrows-alt"></i></button>
                    </div>
                    <div class="content-iframe" style="background-color: #f9f9f9; overflow: hidden;">
                        <div class="mainContent" id="content-main" style="margin: 10px; margin-bottom: 0px; padding: 0;">
                            <iframe class="MST_iframe" width="100%" height="100%" src="/Home/Default" frameborder="0" data-id="/Home/Default"></iframe>
                            <iframe class="MST_iframe" width="100%" height="100%" src="/Home/About" frameborder="0" data-id="/Home/About"></iframe>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="loadingPage" style="display: none;">
        <div class="loading-shade"></div>
        <div class="loading-content" onclick="$.loading(false)">数据加载中，请稍后…</div>
    </div>
    <script src="~/Content/js/index.js"></script>
    <script src="~/Content/js/indextab.js"></script>
    <script src="~/Content/js/loading/pace.min.js"></script>
</body>
</html>
